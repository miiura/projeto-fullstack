{"ast":null,"code":"const express = require('express');\nconst helmet = require('helmet');\nconst compression = require('compression');\nconst morgan = require('morgan');\nconst winston = require('winston');\nconst mongoSanitize = require('express-mongo-sanitize');\nconst xss = require('xss-clean');\nconst rateLimit = require('express-rate-limit');\nconst cors = require('cors');\nconst bodyParser = require('express').json;\n\n// Logger básico (Winston)\nwinston.configure({\n  transports: [new winston.transports.File({\n    filename: 'logs/error.log',\n    level: 'error'\n  }), new winston.transports.File({\n    filename: 'logs/combined.log'\n  })]\n});\nconst createApp = async ({\n  cache,\n  jwtSecret,\n  jwtExpiresIn,\n  rateLimitWindowMs = 60000,\n  rateLimitMax = 10\n}) => {\n  const app = express();\n\n  // Middleware de autenticação\n  const authMiddlewareFactory = require('./middleware/auth');\n  const authMiddleware = authMiddlewareFactory(cache, jwtSecret);\n\n  // Middlewares globais\n  app.use(helmet());\n  app.use(compression());\n  app.use(cors({\n    origin: true\n  }));\n  app.use(bodyParser({\n    limit: '10kb'\n  }));\n  app.use(mongoSanitize());\n  app.use(xss());\n\n  // Logger de requisições HTTP\n  app.use(morgan('combined', {\n    stream: {\n      write: msg => winston.info(msg.trim())\n    }\n  }));\n\n  // Rate-limiting\n  const limiter = rateLimit({\n    windowMs: +rateLimitWindowMs,\n    max: +rateLimitMax,\n    standardHeaders: true,\n    legacyHeaders: false,\n    message: {\n      message: 'Muitas requisições. Tente novamente mais tarde.'\n    }\n  });\n  app.use('/api/', limiter);\n\n  // Rotas\n  const authRoutesFactory = require('./routes/auth.routes');\n  app.use('/api/auth', authRoutesFactory(cache, jwtSecret, jwtExpiresIn));\n  const currencyRoutesFactory = require('./routes/currency.routes');\n  app.use('/api/currency', currencyRoutesFactory(cache, authMiddleware));\n\n  // Healthcheck\n  app.get('/health', (req, res) => res.json({\n    status: 'ok'\n  }));\n\n  // Fallback de erro\n  app.use((err, req, res, next) => {\n    winston.error(err);\n    res.status(500).json({\n      message: 'Erro interno'\n    });\n  });\n  return app;\n};\nmodule.exports = createApp;","map":{"version":3,"names":["express","require","helmet","compression","morgan","winston","mongoSanitize","xss","rateLimit","cors","bodyParser","json","configure","transports","File","filename","level","createApp","cache","jwtSecret","jwtExpiresIn","rateLimitWindowMs","rateLimitMax","app","authMiddlewareFactory","authMiddleware","use","origin","limit","stream","write","msg","info","trim","limiter","windowMs","max","standardHeaders","legacyHeaders","message","authRoutesFactory","currencyRoutesFactory","get","req","res","status","err","next","error","module","exports"],"sources":["D:/Meus dados/Downloads/projeto-fullstack/frontend/src/App.js"],"sourcesContent":["const express = require('express');\nconst helmet = require('helmet');\nconst compression = require('compression');\nconst morgan = require('morgan');\nconst winston = require('winston');\nconst mongoSanitize = require('express-mongo-sanitize');\nconst xss = require('xss-clean');\nconst rateLimit = require('express-rate-limit');\nconst cors = require('cors');\nconst bodyParser = require('express').json;\n\n// Logger básico (Winston)\nwinston.configure({\n  transports: [\n    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),\n    new winston.transports.File({ filename: 'logs/combined.log' })\n  ]\n});\n\nconst createApp = async ({\n  cache,\n  jwtSecret,\n  jwtExpiresIn,\n  rateLimitWindowMs = 60000,\n  rateLimitMax = 10\n}) => {\n  const app = express();\n\n  // Middleware de autenticação\n  const authMiddlewareFactory = require('./middleware/auth');\n  const authMiddleware = authMiddlewareFactory(cache, jwtSecret);\n\n  // Middlewares globais\n  app.use(helmet());\n  app.use(compression());\n  app.use(cors({ origin: true }));\n  app.use(bodyParser({ limit: '10kb' }));\n  app.use(mongoSanitize());\n  app.use(xss());\n\n  // Logger de requisições HTTP\n  app.use(\n    morgan('combined', {\n      stream: { write: (msg) => winston.info(msg.trim()) }\n    })\n  );\n\n  // Rate-limiting\n  const limiter = rateLimit({\n    windowMs: +rateLimitWindowMs,\n    max: +rateLimitMax,\n    standardHeaders: true,\n    legacyHeaders: false,\n    message: { message: 'Muitas requisições. Tente novamente mais tarde.' }\n  });\n  app.use('/api/', limiter);\n\n  // Rotas\n  const authRoutesFactory = require('./routes/auth.routes');\n  app.use('/api/auth', authRoutesFactory(cache, jwtSecret, jwtExpiresIn));\n\n  const currencyRoutesFactory = require('./routes/currency.routes');\n  app.use('/api/currency', currencyRoutesFactory(cache, authMiddleware));\n\n  // Healthcheck\n  app.get('/health', (req, res) => res.json({ status: 'ok' }));\n\n  // Fallback de erro\n  app.use((err, req, res, next) => {\n    winston.error(err);\n    res.status(500).json({ message: 'Erro interno' });\n  });\n\n  return app;\n};\n\nmodule.exports = createApp;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}